{# templates/includes/form_fields.html #}
{% load i18n widget_tweaks %}

<style>
  /* === –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –∏–Ω–ø—É—Ç–æ–≤ === */
  .login_box_area .form-group input,
  .login_box_area .form-group select,
  .login_box_area .form-group textarea {
    width: 100%;
    display: block;
  }

  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥ –∏–Ω–ø—É—Ç –∏ –∫–Ω–æ–ø–∫—É-–≥–ª–∞–∑ */
  .has-eye {
    position: relative;
    display: inline-block;   /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ */
    width: 100%;
    vertical-align: top;
  }

  /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ –≥–ª–∞–∑ */
  .has-eye input {
    padding-right: 2.5rem;
  }

  /* –ü—Ä–∏ –æ—à–∏–±–∫–µ Bootstrap –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–æ–Ω –∏ –æ—Ç—Å—Ç—É–ø ‚Äî —É–±–∏—Ä–∞–µ–º */
  .has-eye .form-control.is-invalid {
    background-image: none !important;
    padding-right: 2.5rem !important;
  }

  /* –ö–Ω–æ–ø–∫–∞-–≥–ª–∞–∑ ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ —Å–ø—Ä–∞–≤–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  .password-toggle.eye-btn {
    position: absolute;
    right: .5rem;
    top: 50%;
    transform: translateY(-50%);
    width: 2rem;
    height: 2rem;
    padding: 0;
    border: none;
    background: transparent;
    color: #6c757d;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
  }

  .password-toggle.eye-btn:hover { color: #000; }

  /* –ò–∫–æ–Ω–∫–∏ –≥–ª–∞–∑ */
  .pw-eye::before {
    content: "üëÅ";
    display: inline-block;
    line-height: 1;
    font-size: 1.1rem;
  }
  .password-toggle.active .pw-eye::before { content: "üôà"; }

  .invalid-feedback.d-block { white-space: pre-line; }
</style>


{% for field in form %}
  <div class="col-md-12 form-group mb-3">
    {% if field.label %}
      <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
    {% endif %}

    {% if field.field.widget.input_type == "password" %}
      <div class="has-eye">
        {{ field|add_class:"form-control"|add_error_class:"is-invalid" }}
        <button
          type="button"
          class="password-toggle eye-btn"
          data-target-id="{{ field.id_for_label }}"
          aria-label="{% trans '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å' %}">
          <span class="pw-eye" aria-hidden="true"></span>
        </button>
      </div>
    {% else %}
      {{ field|add_class:"form-control"|add_error_class:"is-invalid" }}
    {% endif %}

    {% if field.help_text %}
      <small class="form-text text-muted help-text">{{ field.help_text|safe }}</small>
    {% endif %}

    {% if field.errors %}
      {% for error in field.errors %}
        <div class="invalid-feedback d-block">{{ error }}</div>
      {% endfor %}
    {% endif %}
  </div>
{% endfor %}


<script>
  document.addEventListener("DOMContentLoaded", function () {
    // === –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è ===
    document.querySelectorAll(".password-toggle").forEach((btn) => {
      const input = document.getElementById(btn.dataset.targetId);
      if (!input) return;

      btn.addEventListener("click", () => {
        const toText = input.type === "password";
        input.type = toText ? "text" : "password";
        btn.classList.toggle("active", toText);
        btn.setAttribute(
          "aria-label",
          toText ? "–°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å" : "–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å"
        );
      });
    });
  });
</script>
